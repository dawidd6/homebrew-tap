name: Uploading

on:
  workflow_dispatch:
    inputs:
      pull_request:
        description: Pull request number
        required: true

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Homebrew
        uses: Homebrew/actions/setup-homebrew@master
      - name: Set up git
        uses: Homebrew/actions/git-user-config@master
      - name: Pull bottles
        env:
          HOMEBREW_GITHUB_API_TOKEN: ${{secrets.HOMEBREW_GITHUB_API_TOKEN}}
          PULL_REQUEST: ${{github.event.inputs.pull_request}}
          WORKFLOW: building.yml
        run: brew pr-pull --tap=$GITHUB_REPOSITORY --workflow=$WORKFLOW $PULL_REQUEST
      - name: Push commits
        uses: Homebrew/actions/git-try-push@master
        with:
          token: ${{secrets.HOMEBREW_GITHUB_API_TOKEN}}
      - name: Delete branch
        uses: peter-evans/close-pull@v1
        with:
          token: ${{secrets.HOMEBREW_GITHUB_API_TOKEN}}
          pull-request-number: ${{github.event.inputs.pull_request}}
          delete-branch: true
